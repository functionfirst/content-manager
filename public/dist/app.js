angular.module("userApp",["appRoutes","ui-notification","cfp.hotkeys","editor","comment","comments","mainCtrl","loginCtrl","userCtrl","userConfirmCtrl","userRegisterCtrl","userEditCtrl","userCreateCtrl","homeViewCtrl","blogCtrl","blogCreateCtrl","blogEditCtrl","blogViewCtrl","pageCtrl","pageViewCtrl","pageSearchCtrl","authService","commentService","pageService","blogService","userService","sanitize"]).config(["$httpProvider","NotificationProvider",function(e,t){e.interceptors.push("AuthInterceptor"),t.setOptions({delay:4e3,startTop:10,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"top",replaceMessage:!0})}]),function(){function e(e,t){e.when("/",{templateUrl:"app/views/pages/home/index.html",controller:"HomeViewController",controllerAs:"page"}).when("/search",{templateUrl:"app/views/pages/pages/search.html",controller:"PageSearchController",controllerAs:"page"}).when("/login",{templateUrl:"app/views/pages/login.html",controller:"LoginController",controllerAs:"login"}).when("/register",{templateUrl:"/app/views/pages/users/register.html",controller:"UserRegisterController",controllerAs:"user"}).when("/registered",{templateUrl:"/app/views/pages/users/registered.html",controller:"UserConfirmController",controllerAs:"user"}).when("/blogs/:slug",{templateUrl:"app/views/pages/blogs/view.html",controller:"BlogViewController",controllerAs:"blog"}).when("/admin",{templateUrl:"app/views/pages/users/all.html",controller:"UserController",controllerAs:"user",access:{loginRequired:!0}}).when("/admin/users",{templateUrl:"app/views/pages/users/all.html",controller:"UserController",controllerAs:"user",access:{loginRequired:!0}}).when("/admin/users/create",{templateUrl:"app/views/pages/users/create.html",controller:"UserCreateController",controllerAs:"user",access:{loginRequired:!0}}).when("/admin/users/:user_id",{templateUrl:"app/views/pages/users/edit.html",controller:"UserEditController",controllerAs:"user",access:{loginRequired:!0}}).when("/admin/pages",{templateUrl:"app/views/pages/pages/all.html",controller:"PageController",controllerAs:"page",access:{loginRequired:!0}}).when("/admin/blogs",{templateUrl:"app/views/pages/blogs/index.html",controller:"BlogController",controllerAs:"blog",access:{loginRequired:!0}}).when("/admin/blogs/add",{templateUrl:"app/views/pages/blogs/add.html",controller:"BlogCreateController",controllerAs:"blog",access:{loginRequired:!0}}).when("/admin/blogs/:id",{templateUrl:"app/views/pages/blogs/edit.html",controller:"BlogEditController",controllerAs:"blog",access:{loginRequired:!0}}).when("/:name",{templateUrl:"app/views/pages/pages/single.html",controller:"PageViewController",controllerAs:"page"}),t.html5Mode(!0)}e.$inject=["$routeProvider","$locationProvider"],angular.module("appRoutes",["ngRoute"]).config(e)}(),function(){function e(e,t,o,n,r){function s(){t.processing=!0,n.login(e.loginData.username,e.loginData.password).success(function(e){return t.processing=!1,e.error?void r.error(e.error):void o.path("/")})}e.doLogin=s}angular.module("loginCtrl",[]).controller("LoginController",["$scope","$rootScope","$location","Auth","Notification",e])}(),function(){function e(e,t,o,n){e.processing=!1;var r=this;e.setPageTitle=function(t){t&&(page_title=t+" - Content Manager"),e.page_title=page_title},e.$on("$routeChangeStart",function(e,t){n.getUser().then(function(e){r.user=e.data})}),e.reloadRoute=function(){t.reload()},r.doLogout=function(){n.logout(),r.user={},o.path("/login")}}angular.module("mainCtrl",[]).controller("MainController",["$rootScope","$route","$location","Auth",e])}(),function(){function e(e,t,o,n){function r(){o.all().success(function(o){e.processing=!1,t.pages=o})}function s(r){var s=confirm("Are you sure you wish to delete this page?");s&&(e.processing=!0,o.remove(r).success(function(r){n.success(r.message),o.all().success(function(o){e.processing=!1,t.pages=o})}))}e.processing=!0,e.setPageTitle("Pages"),t.deletePage=s,r()}e.$inject=["$rootScope","$scope","Page","Notification"],angular.module("pageCtrl",["pageService"]).controller("PageController",e)}(),function(){function e(e,t,o){function n(){o.all().success(function(o){t.processing=!1,e.users=o})}function r(n){t.processing=!0,o["delete"](n).success(function(n){o.all().success(function(o){t.processing=!1,e.users=o})})}t.processing=!0,e.deleteUser=r,n()}angular.module("userCtrl",["userService"]).controller("UserController",["$scope","$rootScope","User",e])}(),function(){function e(e,t){function o(o,n,r){function s(e,t){return moment(e).isAfter(t)}function i(e){return moment(e).fromNow()}function c(n){o.editing=!0,e.update(n._id,n).success(function(e){t.success(e.message),n.edit=!1,n=e.comment,o.editing=!1})}function l(n){e["delete"](n).success(function(e){e.error&&t.error(e.error),e.message&&(t.success(e.message),o.comments.splice(o.$index,1))})}o.wasEdited=s,o.timeSince=i,o.updateComment=c,o.deleteComment=l}var n={restrict:"E",templateUrl:"/app/views/directives/comment.html",link:o};return n}angular.module("comment",["commentService"]).directive("comment",e),e.$inject=["Comment","Notification"]}(),function(){function e(e,t){function o(o,n,r){function s(t){var n={object:r.object,id:t};e.view(n).success(function(e){e&&(o.comments=e.comments)})}function i(n){if(n.comment){o.processing=!0;var s={object:r.object,id:o.object._id,user:o.user.userid,content:n.comment};e.create(s).success(function(e){t.success(e.message),o.processing=!1,o.comments=e.comments,n.comment=""})}}o.addComment=i,o.$watch("object",function(e){e._id&&s(e._id)},!0)}var n={restrict:"E",scope:{user:"=",object:"="},templateUrl:"/app/views/directives/comments.html",link:o};return n}angular.module("comments",["commentService"]).directive("comments",e),e.$inject=["Comment","Notification"]}(),function(){function e(e){function t(t,o,n,r){var s=new MediumEditor(o,t.bindOptions);t.bindOptions.images&&$("editor").mediumInsert({editor:s,addons:{images:{deleteScript:"/api/images",deleteMethod:"DELETE",fileDeleteOptions:{},fileUploadOptions:{url:"/api/images",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i},uploadCompleted:function(t,o){e.success("Image was uploaded successfully")},uploadFailed:function(t,o){e.error("There was a problem uploading the image")}}}}),r.editor=s,r.$render=function(){o.html(r.$viewValue||"");var e=r.editor.getExtensionByName("placeholder");e&&e.updatePlaceholder(o[0])},r.$isEmpty=function(e){return/[<>]/.test(e)?0===toInnerText(e).length:!e||0===e.length},r.editor.subscribe("editableInput",function(e,t){r.$setViewValue(t.innerHTML.trim())}),t.$watch("bindOptions",function(e){r.editor.init(o,e)}),t.$on("$destroy",function(){r.editor.destroy()})}var o={require:"ngModel",restrict:"E",scope:{bindOptions:"="},link:t};return o}angular.module("editor",[]).directive("editor",e),e.$inject=["Notification"]}(),function(){function e(e){return function(t){return console.log(t),e.trustAsHtml(t)}}angular.module("sanitize",[]).filter("sanitize",e),e.$inject=["$sce"]}(),angular.module("authService",[]).factory("Auth",["$http","$q","$location","AuthToken",function(e,t,o,n){var r={};return r.login=function(t,o){return e.post("/api/authenticate",{username:t,password:o}).success(function(e){return n.setToken(e.token),e})},r.logout=function(){n.setToken()},r.isLoggedIn=function(e,t){if(t=t||{},void 0!==t.access&&t.access.loginRequired)return!!n.getToken()||(o.path("/login"),!1)},r.getUser=function(){return n.getToken()?e.get("/api/me",{cache:!0}):t.reject({message:"User has no token."})},r}]).factory("AuthToken",["$window",function(e){var t={};return t.getToken=function(){return e.localStorage.getItem("token")},t.setToken=function(t){t?e.localStorage.setItem("token",t):e.localStorage.removeItem("token")},t}]).factory("AuthInterceptor",["$q","$location","AuthToken",function(e,t,o){var n={};return n.request=function(e){var t=o.getToken();return t&&(e.headers["x-access-token"]=t),e},n.responseError=function(n){return 403==n.status&&(o.setToken(),t.path("/login")),e.reject(n)},n}]),function(){angular.module("blogService",[]).factory("Blog",["$http",function(e){function t(t,o){return e.get("/api/blogs/"+t)}function o(t){return e.get("/api/blogs/",{params:t})}function n(t){return e.post("/api/blogs",t)}function r(t,o){return e.put("/api/blogs/"+t,o)}function s(t){return e["delete"]("/api/blogs/"+t)}return{get:t,all:o,create:n,update:r,remove:s}}])}(),angular.module("commentService",[]).factory("Comment",["$http",function(e){var t={};return t.view=function(t){return e.get("/api/comments",{params:t})},t.create=function(t){return e.post("/api/comments",t)},t.update=function(t,o){return e.put("/api/comments/"+t,o)},t["delete"]=function(t){return e["delete"]("/api/comments/"+t)},t}]),function(){angular.module("pageService",[]).factory("Page",["$http",function(e){function t(t){return e.get("/api/pages/"+t)}function o(t){return e.get("/api/pages/"+t+"/edit/")}function n(t){return t?e.get("/api/pages?name="+t):e.get("/api/pages")}function r(t){return e.post("/api/pages",t)}function s(t,o){return e.put("/api/pages/"+t,o)}function i(t){return e["delete"]("/api/pages/"+t)}return{get:t,edit:o,all:n,create:r,update:s,remove:i}}])}(),angular.module("userService",[]).factory("User",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/users/"+t)},t.all=function(){return e.get("/api/users")},t.create=function(t){return e.post("/api/users",t)},t.update=function(t,o){return e.put("/api/users/"+t,o)},t.upload=function(t,o){return e.put("/api/users/"+t+"/upload",o)},t["delete"]=function(t){return e["delete"]("/api/users/"+t)},t}]),function(){function e(e,t,o,n){function r(){e.processing=!0,o.create(t.blog).success(function(o){return e.processing=!1,o.error?void n.error(o.error):(t.blog={},void n.success(o.message))})}e.setPageTitle("Add a Blog"),t.create=r}e.$inject=["$rootScope","$scope","Blog","Notification"],angular.module("blogCreateCtrl",["blogService"]).controller("BlogCreateController",e)}(),function(){function e(e,t,o,n){function r(){o.all().success(function(o){e.processing=!1,t.blogs=o})}function s(r){var s=confirm("Are you sure you wish to delete this blog?");s&&(e.processing=!0,o.remove(r).success(function(r){n.success(r.message),o.all().success(function(o){e.processing=!1,t.blogs=o})}))}e.processing=!0,e.setPageTitle("Blogs"),t.deleteBlog=s,r()}e.$inject=["$rootScope","$scope","Blog","Notification"],angular.module("blogCtrl",["blogService"]).controller("BlogController",e)}(),function(){function e(e,t,o,n,r){function s(){n.get(e.id).success(function(e){o.blog=e})}function i(){t.processing=!0,n.update(o.blog._id,o.blog).success(function(e){return t.processing=!1,e.error?void r.error(e.error):void r.success(e.message)})}t.setPageTitle("Blog Updated"),o.update=i,o.mediumBindOptions={toolbar:{buttons:["bold","italic","underline"]}},s()}angular.module("blogEditCtrl",["blogService"]).controller("BlogEditController",e),e.$inject=["$routeParams","$rootScope","$scope","Blog","Notification"]}(),function(){function e(e,t,o,n,r){function s(){var s={slug:t.slug};e.processing=!0,r.all(s).success(function(t){e.processing=!1,o.blog=t[0],o.trustedHtml=n.trustAsHtml(t[0].content),e.setPageTitle(o.blog.title)})}s()}angular.module("blogViewCtrl",["blogService"]).controller("BlogViewController",e),e.$inject=["$rootScope","$routeParams","$scope","$sce","Blog"]}(),function(){function e(e,t,o,n,r){function s(){e.processing=!0,r.all().success(function(t){e.processing=!1,o.blogs=t,e.setPageTitle("Welcome")})}s()}angular.module("homeViewCtrl",["blogService"]).controller("HomeViewController",e),e.$inject=["$rootScope","$routeParams","$scope","$location","Blog"]}(),function(){function e(e,t,o,n){function r(){e.processing=!0,e.setPageTitle("Search results"),e.globalSearch=n.name,o.all(n.name).success(function(o){e.processing=!1,t.pages=o})}r()}e.$inject=["$rootScope","$scope","Page","$routeParams"],angular.module("pageSearchCtrl",["pageService"]).controller("PageSearchController",e)}(),function(){function e(e,t,o,n,r){function s(){e.processing=!0,o.page={name:t.name},r.create(o.page).success(function(t){e.processing=!1})}function i(){o.page_list||r.all().success(function(e){o.page_list=e})}function c(){i(),$("#addToPageModal").modal()}function l(){o.page.parent=null,u()}function a(e){o.page.admin_only=e||!1,u()}function u(){r.update(t.name,o.page).success(function(e){})}function g(e){o.page.parent=e,u(),$("#addToPageModal").modal("hide")}function p(){var s=t.name||"home";e.processing=!0,r.get(s).success(function(t){e.processing=!1,o.page=t,o.trustedHtml=n.trustAsHtml(t.content),e.setPageTitle(t.name)})}p(),o.createPage=s,o.selectParent=c,o.clearParent=l,o.savePage=u,o.setAdminOnly=a,o.selectPage=g,o.mediumBindOptions={toolbar:{buttons:["bold","italic","underline","h1","h2","h3","anchor","quote","orderedlist","unorderedlist","indent","outdent","justifyLeft","justifyCenter","justifyRight","justifyFull"]},images:!0,anchorPreview:!1,keyboardCommands:{commands:[{command:"h1",key:"1",meta:!1,shift:!0,alt:!0}]}}}angular.module("pageViewCtrl",["pageService"]).controller("PageViewController",e),e.$inject=["$rootScope","$routeParams","$scope","$sce","Page"]}(),function(){function e(){}angular.module("userConfirmCtrl",[]).controller("UserConfirmController",e)}(),function(){function e(e,t,o,n){function r(){e.processing=!0,t.user.block=!1,o.create(t.user).success(function(o){return e.processing=!1,o.error?void n.error(o.error):(t.user={},void n.success(o.message))})}t.create=r}e.$inject=["$rootScope","$scope","User","Notification"],angular.module("userCreateCtrl",["userService"]).controller("UserCreateController",e)}(),function(){function e(e,t,o,n,r,s,i){function c(e){if(o.progress=0,e&&e.length)for(var t=0;t<e.length;t++){var n=e[t];s.upload({url:"/api/users/"+o.user._id+"/upload/",data:o.user,method:"POST",file:n}).progress(g).success(p)}}function l(n){t.processing=!0,r.update(e.user_id,{blocked:n}).success(function(e){t.processing=!1,o.user.blocked?i.success("User has been blocked"):i.success("User has been Unblocked"),o.user.blocked=n})}function a(){r.update(e.user_id,{image:null}).success(function(e){t.processing=!1,i.success("Image has been removed"),o.user.image=""})}function u(){t.processing=!0,o.user.removeImage&&(o.user.image=""),r.update(e.user_id,o.user).success(function(e){t.processing=!1,i.success(e.message)})}function g(e){var n=parseInt(100*e.loaded/e.total);o.progress=n,t.processing=!0}function p(e,r,s,c){n(function(){return t.processing=!1,e.error?void i.error(e.error):(o.user.image=e.filename,void i.success(e.message))})}function m(){r.get(e.user_id).success(function(e){o.user=e})}o.upload=c,o.updateUser=u,o.toggleBlock=l,o.removeAvatar=a,m()}e.$inject=["$routeParams","$rootScope","$scope","$timeout","User","Upload","Notification"],angular.module("userEditCtrl",["userService","ngFileUpload"]).controller("UserEditController",e)}(),function(){function e(e,t,o,n,r){function s(){e.processing=!0,n.create(t.user).success(function(n){e.processing=!1,r.success(n.message),n.success&&(t.user={},o.path("/registered"))})}t.registerUser=s}angular.module("userRegisterCtrl",["userService"]).controller("UserRegisterController",["$rootScope","$scope","$location","User","Notification",e])}();